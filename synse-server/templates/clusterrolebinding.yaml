{{- /*
  If Synse Server is configured to run with plugin discovery via the
  Kubernetes API, this template will be rendered. If the Kubernetes
  discovery config is not set, Synse Server will not use the Kubernetes
  API and will not need to be granted additional cluster permissions.
*/ -}}

{{- if .Values.config.plugin.discover.kubernetes }}
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: {{ template "fullname" . }}
  labels:
    {{- include "labels" . | nindent 4 }}
  annotations:
    {{- include "annotations" . | nindent 4 }}
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: {{ template "fullname" . }}
subjects:
- kind: ServiceAccount
  name: {{ template "fullname" . }}
  namespace: {{ .Release.Namespace }}
{{- end }}